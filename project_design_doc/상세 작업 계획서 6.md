---
root_main: "[[프로젝트/프로젝트_main|프로젝트_main]]"
deps: 0
title: 상세 작업 계획서 6
Project: 
Domain: 
Object: 
Scope: 
Asset: 
Source:
Maturity (%): 
entity_type: 
created: 2025-06-26
modified: 2025-06-26 14:01
folder_main: "[[프로젝트/프로젝트_main|프로젝트_main]]"
related_files:
---
### **Part 8: 배포 및 CI/CD 전략 상세 설계**

개발이 완료된 애플리케이션을 안정적으로 사용자에게 제공하고, 지속적인 업데이트를 자동화하기 위한 배포 및 CI/CD(Continuous Integration/Continuous Deployment) 전략을 수립한다.

#### **8.1. 배포 전략: Docker를 이용한 컨테이너화**

* **목표**: "내 컴퓨터에선 되는데, 서버에선 안 돼요" 문제를 원천적으로 차단한다. 프로젝트의 모든 의존성(OS, Python 버전, 라이브러리 등)을 Docker 이미지라는 하나의 패키지로 묶어, 어떤 환경에서든 동일하게 실행되도록 보장한다.  
* **1\. Dockerfile 상세 명세**:  
  * 프로젝트 루트에 Dockerfile을 생성한다.  
  * **구현 명세**:  
    \# 1\. 베이스 이미지 선택 (Python 3.10)  
    FROM python:3.10-slim

    \# 2\. 작업 디렉토리 설정  
    WORKDIR /app

    \# 3\. 시스템 의존성 설치 (필요시)  
    \# 예: 웹 크롤링을 위한 Chrome 드라이버 등  
    \# RUN apt-get update && apt-get install \-y ...

    \# 4\. 의존성 라이브러리 설치  
    \# requirements.txt를 먼저 복사하여 설치함으로써, 소스 코드 변경 시 매번 라이브러리를 재설치하는 것을 방지 (Docker 레이어 캐싱 활용)  
    COPY requirements.txt .  
    RUN pip install \--no-cache-dir \-r requirements.txt

    \# 5\. 프로젝트 전체 소스 코드 복사  
    COPY . .

    \# 6\. Streamlit 포트 노출  
    EXPOSE 8501

    \# 7\. 애플리케이션 실행 명령어  
    \# healthcheck를 추가하여 컨테이너의 정상 동작 여부를 확인할 수 있도록 함  
    HEALTHCHECK CMD streamlit hello  
    CMD \["streamlit", "run", "src/app.py", "--server.port=8501", "--server.address=0.0.0.0"\]

* **2\. .dockerignore 파일 작성**:  
  * Docker 이미지를 빌드할 때 포함되지 않아도 될 파일들을 명시하여 이미지 용량을 줄이고 빌드 속도를 향상시킨다.  
  * **구현 명세**:  
    \# .dockerignore  
    \_\_pycache\_\_/  
    \*.pyc  
    \*.pyo  
    \*.pyd  
    .pytest\_cache/  
    .venv/  
    .git/  
    .gitignore  
    notebooks/  
    data/raw/ \# 원본 데이터는 이미지에 포함시키지 않음  
    logs/  
    \*.log

* **3\. 로컬 실행 및 테스트**:  
  * **이미지 빌드**: docker build \-t tv-recommender-app .  
  * **컨테이너 실행**: docker run \-p 8501:8501 \-v $(pwd)/data:/app/data tv-recommender-app  
    * \-p 8501:8501: 로컬 머신의 8501 포트와 컨테이너의 8501 포트를 연결한다.  
    * \-v $(pwd)/data:/app/data: 로컬의 data 디렉토리(캐시, 로그, 페르소나 파일 등)를 컨테이너 내부의 /app/data 디렉토리와 마운트한다. 이를 통해 컨테이너가 삭제되어도 데이터는 유지된다.

#### **8.2. CI/CD 파이프라인 설계: GitHub Actions 사용**

* **목표**: 코드가 GitHub에 푸시(Push)될 때마다 테스트, 빌드, 배포 과정을 자동화하여 개발 생산성을 높이고, 휴먼 에러를 줄인다.  
* **파이프라인 파일 위치**: .github/workflows/python-app.yml  
* **python-app.yml 상세 명세**:  
  name: Python Application CI/CD

  \# 파이프라인 트리거 조건  
  on:  
    push:  
      branches: \[ "main" \] \# main 브랜치에 push 될 때 실행  
    pull\_request:  
      branches: \[ "main" \] \# main 브랜치로 pull request가 생성될 때 실행

  jobs:  
    \# 1\. CI (테스트 및 린트) 잡  
    build-and-test:  
      runs-on: ubuntu-latest  
      steps:  
      \- name: Checkout repository  
        uses: actions/checkout@v3

      \- name: Set up Python 3.10  
        uses: actions/setup-python@v3  
        with:  
          python-version: "3.10"

      \- name: Install dependencies  
        run: |  
          python \-m pip install \--upgrade pip  
          pip install flake8 pytest  
          pip install \-r requirements.txt

      \- name: Lint with flake8  
        run: |  
          \# 코드 스타일 가이드 준수 여부 검사  
          flake8 . \--count \--select=E9,F63,F7,F82 \--show-source \--statistics  
          flake8 . \--count \--exit-zero \--max-complexity=10 \--max-line-length=127 \--statistics

      \- name: Test with pytest  
        run: |  
          pytest

    \# 2\. CD (빌드 및 배포) 잡  
    build-and-push:  
      \# build-and-test 잡이 성공했을 때만 실행  
      needs: build-and-test  
      \# main 브랜치에 직접 push 되었을 때만 실행 (PR에서는 실행 안 함)  
      if: github.event\_name \== 'push' && github.ref \== 'refs/heads/main'  
      runs-on: ubuntu-latest  
      steps:  
      \- name: Checkout repository  
        uses: actions/checkout@v3

      \- name: Login to Docker Hub  
        uses: docker/login-action@v2  
        with:  
          username: ${{ secrets.DOCKERHUB\_USERNAME }}  
          password: ${{ secrets.DOCKERHUB\_TOKEN }}

      \- name: Build and push Docker image  
        uses: docker/build-push-action@v4  
        with:  
          context: .  
          push: true  
          tags: ${{ secrets.DOCKERHUB\_USERNAME }}/tv-recommender-app:latest

  \# (선택적) 3\. 원격 서버 배포 잡  
  deploy-to-server:  
    needs: build-and-push  
    if: github.event\_name \== 'push' && github.ref \== 'refs/heads/main'  
    runs-on: ubuntu-latest  
    steps:  
    \- name: Deploy to remote server  
      uses: appleboy/ssh-action@master  
      with:  
        host: ${{ secrets.REMOTE\_HOST }}  
        username: ${{ secrets.REMOTE\_USER }}  
        key: ${{ secrets.SSH\_PRIVATE\_KEY }}  
        script: |  
          \# 원격 서버에서 실행할 스크립트  
          docker pull ${{ secrets.DOCKERHUB\_USERNAME }}/tv-recommender-app:latest  
          docker stop tv-recommender-container || true  
          docker rm tv-recommender-container || true  
          docker run \-d \--name tv-recommender-container \-p 8501:8501 \-v /home/user/data:/app/data ${{ secrets.DOCKERHUB\_USERNAME }}/tv-recommender-app:latest

* **필수 설정 (GitHub Secrets)**:  
  * Settings \> Secrets and variables \> Actions 에서 다음의 Secret들을 등록해야 한다.  
    * DOCKERHUB\_USERNAME: Docker Hub 사용자 이름  
    * DOCKERHUB\_TOKEN: Docker Hub Access Token  
    * REMOTE\_HOST: 배포할 서버의 IP 주소 또는 도메인  
    * REMOTE\_USER: 서버 접속 사용자 이름  
    * SSH\_PRIVATE\_KEY: 서버 접속에 사용할 SSH 비공개 키
